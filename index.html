<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vertex Monaco | Scanner de Vitrine</title>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>
    <style>
        :root { --accent: #00CCFF; --bg: #050505; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: white; overflow: hidden; }
        
        /* Interface de Scan */
        #scan-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1000; background: #000; display: flex; flex-direction: column;
        }
        
        #camera-feed { width: 100%; height: 70%; background: #222; object-fit: cover; }

        .instruction-bar {
            padding: 20px; text-align: center; background: rgba(0,204,255,0.1);
            border-bottom: 1px solid var(--accent);
        }

        .recommendation-panel {
            padding: 20px; display: none; text-align: center;
        }

        .btn-action {
            background: var(--accent); color: #000; border: none;
            padding: 15px 30px; font-weight: bold; border-radius: 4px;
            margin-top: 10px; cursor: pointer; text-transform: uppercase;
        }

        /* Viewer 3D masqué au début */
        #final-viewer { display: none; width: 100vw; height: 100vh; }
    </style>
</head>
<body>

    <div id="scan-container">
        <div class="instruction-bar">
            <h2 style="margin:0; font-size:1rem;">1. DÉLIMITEZ VOTRE VITRINE</h2>
            <p style="font-size:0.7rem; opacity:0.7;">Cadrez votre vitrine et validez la zone disponible.</p>
        </div>
        
        <video id="camera-feed" autoplay playsinline></video>

        <div class="recommendation-panel" id="result-box">
            <h3 id="recommended-model">ANALYSE EN COURS...</h3>
            <p id="model-details" style="font-size:0.8rem;"></p>
            <button class="btn-action" onclick="showInAR()">Voir ce modèle en AR</button>
        </div>

        <div id="scan-trigger" style="text-align:center; padding: 20px;">
            <button class="btn-action" onclick="analyzeWindow()" style="background:white;">Scanner la zone</button>
        </div>
    </div>

    <model-viewer id="final-viewer" ar ar-modes="webxr scene-viewer" ar-scale="fixed" camera-controls src="">
        <button slot="ar-button" class="btn-action" style="position:absolute; bottom:30px; left:50%; transform:translateX(-50%);">
            Lancer le test réel
        </button>
    </model-viewer>

    <script>
        const video = document.getElementById('camera-feed');
        const resultBox = document.getElementById('result-box');
        const scanTrigger = document.getElementById('scan-trigger');

        // Accès caméra
        navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
            .then(stream => { video.srcObject = stream; })
            .catch(err => alert("L'accès caméra est requis pour le diagnostic."));

        function analyzeWindow() {
            // Simulation d'IA d'analyse de surface
            scanTrigger.style.display = 'none';
            resultBox.style.display = 'block';
            
            // Logique de recommandation simplifiée
            // Dans une version finale, on utiliserait les capteurs de profondeur (LiDAR)
            const models = [
                { name: 'Vertex Double-Face 55"', file: 'Double-Face 55_.glb', desc: 'Idéal pour vitrines standards (largeur < 1m)' },
                { name: 'Vertex Double-Face 65"', file: 'Double-Face 65_.glb', desc: 'Recommandé pour grandes vitrines' }
            ];
            
            const choice = models[0]; // Simulation d'un choix 55"
            document.getElementById('recommended-model').innerText = `RECOMMANDATION : ${choice.name}`;
            document.getElementById('model-details').innerText = choice.desc;
            document.getElementById('final-viewer').src = choice.file;
        }

        function showInAR() {
            document.getElementById('scan-container').style.display = 'none';
            document.getElementById('final-viewer').style.display = 'block';
        }
    </script>
</body>
</html>
